{% extends "kakeibo/base.html" %}
{% load humanize %}
{% block title %}
    Asset dashboard
{% endblock %}

{% block body %}
  <div class="container-fluid">
    <hr>
    <div class="row">
      <div class="col-sm-9">
        <h1>
          <i class="fab fa-servicestack"></i> 資産運用概要: {{today.year}}年{{today.month}}月{{today.day}}日
        </h1>
      </div>
      <div class="col-sm-3">
      </div>
    </div>
    <hr>

    <!-- Graphs -->
    <h2>Graphs</h2>
    <div class="row">
      <div class="col-sm-3">
        <canvas id="pie_holding_stocks"></canvas>
      </div>
      <div class="col-sm-5">
        <canvas id="bar_holding_stocks"></canvas>
      </div>
      <div class="col-sm-4">
        <table class="table table-light table-hover table-sm">
          <thead>
            <tr>
              <th>Key</th>
              <th class="right">Val</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>保有株式</td>
              <td class="right">¥ {{total| intcomma}}</td>
            </tr>
            <tr>
              <td>買付余力</td>
              <td class="right">¥{{buying_power | intcomma}}</td>
            </tr>
            <tr>
              <td>総計</td>
              <td class="right">¥{{total_b| intcomma}}</td>
            </tr>
            <tr>
              <td>収益</td>
              <td class="right"><font color="{{total_color}}">¥{{benefit| intcomma}}</font></td>
            </tr>
            <tr>
              <td>投資額</td>
              <td class="right">¥{{investment| intcomma}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <hr>

    <!-- Table -->
    <h2>Holding Stocks</h2>
    <div class="row">
      <div class="col-sm-12">
        <table class="table table-light table-hover table-sm table-responsive-md">
          <thead>
            <tr>
              <th>Buying Date</th>
              <th>Code</th>
              <th>Name</th>
              <th class="right">Num</th>
              <th class="right">Buying price</th>
              <th class="right">Current price</th>
              <th class="right">Total</th>
              <th class="right">Benefit</th>
            </tr>
          </thead>
          <tbody>
            {% for hs in hstocks %}
            <tr>
              <td>{{hs.date}}</td>
              <td>{{hs.code}}</td>
              <td>{{hs.name}}</td>
              <td class="right">{{hs.num}}</td>
              <td class="right">¥{{hs.aprice | intcomma}}</td>
              <td class="right">¥{{hs.cprice | intcomma}}</td>
              <td class="right">¥{{hs.ctotal | intcomma}}</td>
              <td class="right"><font color="{{hs.color}}">¥{{hs.benefit | intcomma}}</font></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <hr>

    <h2>Date shift</h2>
    <div class="row">
      <div class="col-sm-12">
        <canvas id="date_shift"></canvas>
      </div>
    </div>
  </div>


  <!-- pie_holding_stocks -->
  <script>
    var ctx = document.getElementById('pie_holding_stocks').getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ["Buying power", {%for hs in hstocks%}"{{hs.code}}",{%endfor%}],
        datasets: [{
          label: "alice",
          data: [{{buying_power}}, {%for hs in hstocks%}{{hs.ctotal}},{%endfor%}],
          backgroundColor: [
            "#2ecc71",
            "#3498db",
            "#95a5a6",
            "#9b59b6",
            "#f1c40f",
            "#e74c3c",
            "#34495e"
           ]
        }]
      }
    });
  </script>

  <!-- bar_holding_stocks -->
  <script>
    var ctx = document.getElementById('bar_holding_stocks').getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [{%for hs in hstocks%}"{{hs.code}}",{%endfor%}],
        datasets: [{
          label: 'Buying price',
          data: [{%for hs in hstocks%}{{hs.atotal}},{%endfor%}],
          backgroundColor: "rgba(153,255,51,0.4)"
        }, {
          label: 'Current price',
          data: [{%for hs in hstocks%}{{hs.ctotal}},{%endfor%}],
          backgroundColor: "rgba(255,153,0,0.4)"
        }]
      }
    });
  </script>

  <!-- Date shift -->
  <script>
    var lineChartData = {
      labels : [{%for ass in astatus%} "{{ass.date}}", {%endfor%}],
      datasets : [
        {
          label: "その他投資",
          data: [{%for ass in astatus%} {{ass.other_value}}, {%endfor%}],
          backgroundColor: "rgba(53,255,151,0.4)",
          //fill: false,
        },
        {
          label: "株式",
          data: [{%for ass in astatus%} {{ass.stocks_value}}, {%endfor%}],
          backgroundColor: "rgba(255,153,0,0.4)",
          //fill: false,
        },
        {
          label: "買付余力",
          data: [{%for ass in astatus%} {{ass.buying_power}}, {%endfor%}],
          backgroundColor: "rgba(153,255,51,0.4)",
          //fill: false,
        },
      ]
    }
    var options = {
      scales: {
        yAxes: [{
          stacked: true
        }]
      },
      responsive: true,
    }
    var ctx = document.getElementById("date_shift").getContext("2d");
    var myChart = new Chart(ctx, {
        type: "line",
        data: lineChartData,
        options: options,
        // 下記を追加すると線がまっすぐになります
        /* bezierCurve: false */
    });
  </script>

{% endblock %}
