{% extends "kakeibo/base.html" %}
{% load humanize %}
{% block title %}
    My Dashboard
{% endblock %}
 
{% block body %}

<div class="container-fluid">
  <hr>
  <div class="row">
    <div class="col-sm-6">
      <h1>
        <i class="fas fa-user-circle"></i> {{today.year}}年{{today.month}}月
      </h1>
    </div>

    <div class="col-sm-6">
      <form class="form-horizontal" method="get" action="{% url 'kakeibo:mine' %}">
        {% csrf_token %}
        <div class="form-group">
          <label class="control-label col-xs-2">Year&Month</label>
          <div class="row">
            <div class="col-5">
              <input type="month" name="yearmonth">
            </div>
            <div class="col-4">
              <input type="submit" value="Check">
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <hr>
  <div class="row">
    <div class="col-sm-4">
      <button class="btn btn-block btn-lg btn-outline-info">貯金 ¥{{saved | intcomma}}</button>
    </div>
    <div class="col-sm-4">
      <button class="btn btn-block btn-lg btn-outline-{{status}}">収支 ¥{{inout | intcomma}}</button>
    </div>
    <div class="col-sm-4">
      <div class="progress" style="height:25px">
        <div class="progress-bar bg-success progress-bar-striped" style="width:{{pb_kakeibo.in}}%; height:25px">
          収入 ¥{{income | intcomma}}
        </div>
      </div>
      <div class="progress" style="height:25px">
        <div class="progress-bar bg-warning progress-bar-striped" style="width:{{pb_kakeibo.out}}%; height:25px">
          支出 ¥{{expense | intcomma}}
        </div>
      </div>
    </div>
  </div>

  <hr>
  <div class="row">

    <div class="col-sm-8">
      <h4>推移</h4>
      <canvas id="bar_resources_year"></canvas>
    </div>
    <div class="col-sm-4">
      <h4>支出用途</h4>
      <canvas id="pie_usage" height="360" width="320"></canvas>
    </div>
  </div>

  <hr>
  <div class="row">
    <div class="col-sm-4">
      <h5>推移について</h5>
      <table class="table table-light table-hover table-sm">
        <thead>
          <tr>
            <th>Key</th>
            <th class="right">Value</th>
          </tr>
        </thead>
        <tbody class="">
          <tr>
            <td>合計貯金額</td>
            <td class="right">¥100,000</td>
          </tr>
          <tr>
            <td>年間貯金推移 {{resources_year_chart.1.val.1}}</td>
            <td class="right"><font color="red">-¥50,000</font></td>
          </tr>
          <tr>
            <td>合計資産</td>
            <td class="right">¥1,250,000</td>
          </tr>
          <tr>
            <td>年間資産推移</td>
            <td class="right"><font color="red">-¥50,000</font></td>
          </tr>

        </tbody>
      </table>
    </div>

    <div class="col-sm-4">
      <h5>資産内訳</h5>
      <table class="table table-light table-hover table-sm">
        <thead>
          <tr>
            <th>口座</th>
            <th class="right">金額</th>
          </tr>
        </thead>
        <tbody class="">
          {% for r in resources_chart %}
          <tr>
            <td>{{r.name}}</td>
            <td class="right">¥{{r.this_month | intcomma}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="col-sm-4">
      <h5>用途別支出内訳</h5>
      <table class="table table-light table-hover table-sm">
        <thead>
          <tr>
            <th>用途</th>
            <th class="right">金額</th>
          </tr>
        </thead>
        <tbody class="">
          {% for u in usages_chart %}
          <tr>
            <td>{{u.name}}</td>
            <td class="right">¥{{u.val | intcomma}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <hr>
  <div class="row">
    <div class="col-sm-12">
      <h4>{{today.year}}年実績</h4>
      <table class="table table-light table-hover table-sm table-responsive-md">
        <thead>
          <tr>
            <th></th>
            <th class="right">合計</th>
            {% for i in usage_list %}
            <th class="right">{{i}}</th>
            {% endfor%}
          </tr>
        </thead>
        <tbody>
          {% for i in kakeibo_usage_table2 %}
          <tr>
            <td>{{i.month}}月</td>
            <td class="right">¥{{i.sum | intcomma}}</td>
            {% for j in i.data %}
            <td class="right">¥{{j | intcomma}}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!--<div class="col-sm-12">-->
      <!--<table class="table table-light table-hover table-sm">-->
        <!--<thead>-->
          <!--<tr>-->
            <!--<th>月</th>-->
            <!--<th>用途</th>-->
            <!--<th class="right">合計</th>-->
            <!--<th class="right">平均</th>-->
            <!--<th class="right">回数</th>-->
          <!--</tr>-->
        <!--</thead>-->
        <!--<tbody class="">-->
          <!--{% for kut in kakeibo_usage_table %}-->
          <!--<tr>-->
            <!--<td>{{kut.date.year}}/{{kut.date.month}}</td>-->
            <!--<td>{{kut.name}}</td>-->
            <!--<td class="right">¥{{kut.sum | intcomma}}</td>-->
            <!--<td class="right">¥{{kut.avg | intcomma}}</td>-->
            <!--<td class="right">{{kut.count}}</td>-->
          <!--</tr>-->
          <!--{% endfor %}-->
        <!--</tbody>-->
      <!--</table>-->
    <!--</div>-->
  </div>

</div>

<!-- pie_usage -->
<script>
  var ctx = document.getElementById('pie_usage').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: [{%for u in usages_chart%}"{{u.name}}",{%endfor%}],
      datasets: [{
        label: "alice",
        data: [{%for u in usages_chart%}{{u.val}},{%endfor%}],
        backgroundColor: [
          "#2ecc71",
          "#3498db",
          "#95a5a6",
          "#9b59b6",
          "#f1c40f",
          "#e74c3c",
          "#34495e",
          "#bee95e",

          "#2ecc71",
          "#3498db",
          "#95a5a6",
          "#9b59b6",
          "#f1c40f",
          "#e74c3c",
          "#34495e",
          "#bee95e",
         ]
      }]
    }
  });
</script>


<!-- bar_resources -->
<script>
  var ctx = document.getElementById('bar_resources').getContext('2d');
  var options = {
    scales: {
      yAxes: [{
        stacked: true
      }]
    }
  }
  var colors = [
    "rgba(250,153,0,0.4)",
    "rgba(0,153,253,0.4)",
    "rgba(153,250,0,0.4)",
    "rgba(153,0,253, 0.4)",
    "rgba(253,0,150,0.4)",
  ]
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ["今月", "先月"],
      datasets: [
        {%for r in resources_chart%}
        {
          label: "{{r.name}}",
          data: [{{r.this_month}}, {{r.last_month}}],
          backgroundColor: colors[{{ forloop.counter0 }}]
        },
        {% endfor %}
      ],
    },
    options: options
  });
</script>

<!-- bar_eom -->
<script>
  var ctx = document.getElementById('bar_eom').getContext('2d');
  var options = {
    scales: {
      yAxes: [{
        stacked: true
      }]
    }
  }
  var colors = [
    "rgba(250,153,  0,0.4)",
    "rgba(  0,153,253,0.4)",
    "rgba(153,250,  0,0.4)",
    "rgba(153,  0,253,0.4)",
    "rgba(253,  0,150,0.4)",
    "rgba(  0,253,153,0.4)",
  ]
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{%for l in bar_eom.labels%}"{{l}}",{%endfor%}],
      datasets: [
        {%for key,val in bar_eom.data.items%}
        {
          label: "{{key}}",
          data: [{%for v in val%}{{v}},{%endfor%}],
          backgroundColor: colors[{{ forloop.counter0 }}]
        },
        {% endfor %}
      ],
    },
    options: options
  });
</script>

<!-- bar_resources_year -->
<script>
  var ctx = document.getElementById('bar_resources_year').getContext('2d');
  var options = {
    scales: {
      yAxes: [{
        stacked: true
      }]
    }
  }
  var colors = [
    "rgba(250,153,0,0.4)",
    "rgba(0,153,253,0.4)",
    "rgba(153,250,0,0.4)",
    "rgba(153,0,253, 0.4)",
    "rgba(253,0,150,0.4)",
  ]
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{% for i in months_chart %}"{{i}}", {%endfor%}],
      datasets: [
        {%for r in resources_year_chart%}
        {
          label: "{{r.name}}",
          data: {{r.val}},
          backgroundColor: colors[{{ forloop.counter0 }}]
        },
        {% endfor %}
      ],
    },
    options: options
  });
</script>

{% endblock %}
